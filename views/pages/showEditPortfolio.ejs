<!-- breadcrumbs -->
<ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/portfolios">Portfolios</a></li>
    <li class="active">Edit portfolio</li>
</ol>

<div class="jumbotron text-center customizedNormal bg-no-overlay">
    <div class="row">
        <div class="col-sm-12 contentCentered">
            <img class="img-circle" src="<%= user.google.imageUrl %>" alt="<%= user.google.name %>">
            <div class="textInTransparentBlack">
                <h1><%= user.google.name %></h1>
                <h2>Edit Portfolio</h2>
                <h3><a href="/portfolios/<%= user.google.id %>"><span class="glyphicon glyphicon-check" aria-hidden="true"></span> View</a></h3>
            </div>
        </div>
    </div>
</div>

<% if(errors.length > 0) { %>
    <div class="alert alert-danger">
        <% for(error of errors) { %>
            <%= error %><br>
        <% } %>
    </div>
<% } %>

<% if(success.length > 0) { %>
    <div class="alert alert-success">
        <%= success %>
    </div>
<% } %>

<form id="editPortfolioForm" action="/portfolios/editPortfolio" enctype="multipart/form-data" method="POST">
    <div class="form-group">
        <label for="profileTitle">Profile Title</label>
        <input type="text" name="profileTitle" class="form-control" value="<%= portfolio.profileTitle %>">
    </div>

    <div class="form-group">
        <label for="profileDescription">Profile Description</label>
        <textarea name="profileDescription" id="profileDescription" class="form-control"><%= portfolio.profileDescription %></textarea>
    </div>

    <hr class="featurette-divider">

    <div class="form-group">
        <label for="cvInputFile">Curriculum Vitae</label>
        <input type="file" id="cvInputFile" name="cvInputFile">
        <% if(portfolio.cv.length > 0) { %>
        <p class="help-block">You already uploaded a CV named <%= path.basename(portfolio.cv) %></p>
        <% } else { %>
        <p class="help-block">No uploaded CV so far</p>
        <% } %>
    </div>

    <hr class="featurette-divider">

    <!-- User's web links -->
    <%  
    var githubPrefix = "https://github.com/";
    var stackoverflowPrefix = "https://stackoverflow.com/users/";
    var linkedinPrefix = "https://www.linkedin.com/in/";
    var hackerrankPrefix = "https://www.hackerrank.com/";

    var githubFormVal = "";
    var stackoverflowFormVal = "";
    var linkedinFormVal = "";
    var hackerrankFormVal = "";

    var githubStr = portfolio.webportals.github;
    var stackoverflowStr = portfolio.webportals.stackoverflow;
    var linkedinStr = portfolio.webportals.linkedin;
    var hackerrankStr = portfolio.webportals.hackerrank;

    if(githubStr.length > 0) {        
        githubFormVal = githubStr.substring(githubStr.indexOf(githubPrefix) + githubPrefix.length);
    }
    if(stackoverflowStr.length > 0) {        
        stackoverflowFormVal = stackoverflowStr.substring(stackoverflowStr.indexOf(stackoverflowPrefix) + stackoverflowPrefix.length);
    }
    if(linkedinStr.length > 0) {        
        linkedinFormVal = linkedinStr.substring(linkedinStr.indexOf(linkedinPrefix) + linkedinPrefix.length);
    }
    if(hackerrankStr.length > 0) {        
        hackerrankFormVal = hackerrankStr.substring(hackerrankStr.indexOf(hackerrankPrefix) + hackerrankPrefix.length);
    }
    %>
    <div class="form-group">
        <div class="row">
            <!-- Github -->
            <div class="col-sm-6 contentCentered weblinks">
                <img src="/images/github-140.png" alt="Github" width="140" height="140">
                <h2>Github</h2>
                <span>
                    https://github.com/<input type="text" name="githubLink" value="<%= githubFormVal %>">
                </span>
            </div>
            <!-- Stack Overflow -->
            <div class="col-sm-6 contentCentered weblinks">
                <img src="/images/stackoverflow-140.png" alt="Stack Overflow" width="140" height="140">
                <h2>Stack Overflow</h2>
                <span>
                    https://stackoverflow.com/users/<input type="text" name="stackoverflowLink" value="<%= stackoverflowFormVal %>">
                </span>
            </div>
            <!-- LinkedIn -->
            <div class="col-sm-6 contentCentered weblinks">
                <img src="/images/linkedin-140.png" alt="LinkedIn" width="140" height="140">
                <h2>LinkedIn</h2>
                <span>
                    https://www.linkedin.com/in/<input type="text" name="linkedinLink" value="<%= linkedinFormVal %>">
                </span>
            </div>
            <!-- Hackerrank -->
            <div class="col-sm-6 contentCentered weblinks">
                <img src="/images/hackerrank-140.png" alt="Hackerrank" width="140" height="140">
                <h2>Hackerrank</h2>
                <span>
                    https://www.hackerrank.com/<input type="text" name="hackerrankLink" value="<%= hackerrankFormVal %>">
                </span>
            </div>
        </div>
    </div>

    <hr class="featurette-divider">

    <div data-example-id="contextual-panels-projects">
        <div class="panel panel-primary">
            <div class="panel-heading"><h3 class="panel-title">Projects list</h3></div>
            <div class="panel-body">
                <ol class='project-orderable-list'>
                    <% for(project of portfolio.projectList) { %>
                    <li data-id="<%= project.id %>"><i class="fa fa-arrows" aria-hidden="true"></i> <%= project.name %></li>
                    <% } %>
                </ol>
            </div>
        </div>
        <input type="hidden" id="hiddenProjectList" name="hiddenProjectList" value="">
    </div>

    <hr class="featurette-divider">

    <div class="form-group">
        <button type="submit" id="editPortfolioSubmitBtn" class="btn btn-success btn-lg">Update all</button>
    </div>
</form>

<script>
    $(function () {
        $('#profileDescription').summernote({
            // close prettify Html
            prettifyHtml:false,
            toolbar: [
                // [groupName, [list of button]]
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'hr']],
                ['view', ['fullscreen', 'codeview']],
                ['help', ['help']],
                ['highlight', ['highlight']]
            ],
            popover: {
                image: [
                    ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
                    ['float', ['floatLeft', 'floatRight', 'floatNone']],
                    ['remove', ['removeMedia']]
                ],
                link: [
                    ['link', ['linkDialogShow', 'unlink']]
                ],
                air: [
                    ['color', ['color']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['para', ['ul', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture']]
                ]
            }
        });
        
        var sortableProjectList = $("ol.project-orderable-list").sortable();
        
        $('#editPortfolioForm').submit(function() {
            var data = sortableProjectList.sortable("serialize").get();
            var jsonString = JSON.stringify(data, null, ' ');
            $("#hiddenProjectList").val(jsonString);
            //event.preventDefault();
        });

        /*
        $("#editPortfolioSubmitBtn").on("click", function() {
            $("#hiddenProjectList").val(sortableProjectList.sortable("serialize").get());
        });
        */
    });
</script>
